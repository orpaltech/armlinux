From d2f132c1a3d918126fc6d7cab0533bade1b76713 Mon Sep 17 00:00:00 2001
From: Sergey Suloev <ssuloev@orpaltech.com>
Date: Sat, 26 May 2018 14:28:24 +0300
Subject: [PATCH] sun50i-a64: Device tree updates for A64 SoC boards

---
 .../dts/allwinner/sun50i-a64-nanopi-a64.dts   | 52 +++++++++++++--
 arch/arm64/boot/dts/allwinner/sun50i-a64.dtsi | 64 ++++++++++++++++++-
 2 files changed, 111 insertions(+), 5 deletions(-)

diff --git a/arch/arm64/boot/dts/allwinner/sun50i-a64-nanopi-a64.dts b/arch/arm64/boot/dts/allwinner/sun50i-a64-nanopi-a64.dts
index e2dce48..ae12b16 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-a64-nanopi-a64.dts
+++ b/arch/arm64/boot/dts/allwinner/sun50i-a64-nanopi-a64.dts
@@ -51,6 +51,8 @@
 	compatible = "friendlyarm,nanopi-a64", "allwinner,sun50i-a64";
 
 	aliases {
+		ethernet0 = &emac;
+		ethernet1 = &rtl8189etv;
 		serial0 = &uart0;
 	};
 
@@ -67,15 +69,35 @@
 	status = "okay";
 };
 
-/* i2c1 connected with gpio headers like pine64, bananapi */
+&emac {
+	pinctrl-names = "default";
+	pinctrl-0 = <&rgmii_pins>;
+	phy-mode = "rgmii";
+	phy-handle = <&ext_rgmii_phy>;
+	phy-supply = <&reg_dc1sw>;
+	status = "okay";
+};
+
+&i2c0 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&i2c0_pins>;
+};
+
 &i2c1 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&i2c1_pins>;
-	status = "disabled";
 };
 
-&i2c1_pins {
-	bias-pull-up;
+&i2c2 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&i2c2_pins>;
+};
+
+&mdio {
+	ext_rgmii_phy: ethernet-phy@0 {
+		compatible = "ethernet-phy-ieee802.3-c22";
+		reg = <0>;
+	};
 };
 
 &mmc0 {
@@ -88,6 +110,20 @@
 	status = "okay";
 };
 
+&mmc1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&mmc1_pins>;
+	vmmc-supply = <&reg_dcdc1>;
+	vqmmc-supply = <&reg_dldo4>;
+	non-removable;
+	bus-width = <4>;
+	status = "okay";
+
+	rtl8189etv: sdio_wifi@1 {
+		reg = <1>;
+	};
+};
+
 &ohci0 {
 	status = "okay";
 };
@@ -96,6 +132,10 @@
 	status = "okay";
 };
 
+&r_i2c {
+	status = "okay";
+};
+
 &r_rsb {
 	status = "okay";
 
@@ -153,6 +193,10 @@
 	regulator-name = "vdd-sys";
 };
 
+&reg_dc1sw {
+	regulator-name = "vcc-phy";
+};
+
 &reg_dldo1 {
 	regulator-always-on;
 	regulator-min-microvolt = <3300000>;
diff --git a/arch/arm64/boot/dts/allwinner/sun50i-a64.dtsi b/arch/arm64/boot/dts/allwinner/sun50i-a64.dtsi
index 1b2ef28..6fcc1d9 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-a64.dtsi
+++ b/arch/arm64/boot/dts/allwinner/sun50i-a64.dtsi
@@ -135,6 +135,7 @@
 	sound_spdif {
 		compatible = "simple-audio-card";
 		simple-audio-card,name = "On-board SPDIF";
+		status = "disabled";
 
 		simple-audio-card,cpu {
 			sound-dai = <&spdif>;
@@ -339,6 +340,36 @@
 				function = "i2c1";
 			};
 
+			i2c2_pins: i2c2_pins {
+				pins = "PE14", "PE15";
+				function = "i2c2";
+			};
+
+			i2s0_pins_mclk: i2s0@0 {
+				pins = "PB3";
+				function = "i2s0";
+			};
+
+			i2s0_pins_bclk: i2s0@1 {
+				pins = "PB5";
+				function = "i2s0";
+			};
+
+			i2s0_pins_lrck: i2s0@2 {
+				pins = "PB4";
+				function = "i2s0";
+			};
+
+			i2s0_pins_do0: i2s0@3 {
+				pins = "PB6";
+				function = "i2s0";
+			};
+
+			i2s0_pins_di: i2s0@7 {
+				pins = "PB7";
+				function = "i2s0";
+			};
+
 			mmc0_pins: mmc0-pins {
 				pins = "PF0", "PF1", "PF2", "PF3",
 				       "PF4", "PF5";
@@ -474,6 +505,20 @@
 			status = "disabled";
 		};
 
+		i2s2: i2s@1c22800 {
+			#sound-dai-cells = <0>;
+			compatible = "allwinner,sun50i-a64-i2s",
+				     "allwinner,sun8i-h3-i2s";
+			reg = <0x01c22800 0x400>;
+			interrupts = <GIC_SPI 15 IRQ_TYPE_LEVEL_HIGH>;
+			clocks = <&ccu CLK_BUS_I2S2>, <&ccu CLK_I2S2>;
+			clock-names = "apb", "mod";
+			resets = <&ccu RST_BUS_I2S2>;
+			dma-names = "tx";
+			dmas = <&dma 27>;
+			status = "disabled";
+		};
+
 		uart0: serial@1c28000 {
 			compatible = "snps,dw-apb-uart";
 			reg = <0x01c28000 0x400>;
@@ -562,7 +607,6 @@
 			#size-cells = <0>;
 		};
 
-
 		spi0: spi@1c68000 {
 			compatible = "allwinner,sun8i-h3-spi";
 			reg = <0x01c68000 0x1000>;
@@ -655,6 +699,19 @@
 			#reset-cells = <1>;
 		};
 
+		r_i2c: i2c@1f02400 {
+			compatible = "allwinner,sun6i-a31-i2c";
+			reg = <0x01f02400 0x400>;
+			interrupts = <GIC_SPI 44 IRQ_TYPE_LEVEL_HIGH>;
+			clocks = <&r_ccu CLK_APB0_I2C>;
+			resets = <&r_ccu RST_APB0_I2C>;
+			pinctrl-names = "default";
+			pinctrl-0 = <&r_i2c_pins>;
+			status = "disabled";
+			#address-cells = <1>;
+			#size-cells = <0>;
+		};
+
 		r_pio: pinctrl@1f02c00 {
 			compatible = "allwinner,sun50i-a64-r-pinctrl";
 			reg = <0x01f02c00 0x400>;
@@ -666,6 +723,11 @@
 			interrupt-controller;
 			#interrupt-cells = <3>;
 
+			r_i2c_pins: r_i2c@0 {
+				pins = "PL8", "PL9";
+				function = "s_i2c";
+			};
+
 			r_rsb_pins: rsb {
 				pins = "PL0", "PL1";
 				function = "s_rsb";
-- 
2.17.0

